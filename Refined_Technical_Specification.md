# Уточненное Техническое Задание: Проект "Traders_Trade_Diary" (Поэтапная Разработка)

## 1. Общее описание проекта

Проект "Traders_Trade_Diary" - это веб-приложение для ведения личного дневника сделок на Московской бирже. Приложение реализуется поэтапно, начиная с MVP для одного пользователя (автора проекта), с возможностью масштабирования до полноценного веб-сервиса в случае успеха.

## 2. Цели проекта

### 2.1 Основная цель
Создать удобный инструмент для анализа и ведения дневника сделок с поддержкой импорта отчетов брокера, ручного ввода сделок и аналитики позиций.

### 2.2 Этапы развития
- **Этап 1 (MVP)**: Однопользовательская версия для личного использования
- **Этап 2 (Расширение)**: Подготовка к многопользовательскому режиму
- **Этап 3 (Продакшен)**: Развертывание для широкого использования (при положительной оценке MVP)

## 3. Требования к MVP (Этап 1)

### 3.1 Ограничения
- Только один пользователь (владелец приложения)
- Нет регистрации новых пользователей
- Нет OAuth интеграций
- Не требуется масштабируемость для множества пользователей
- Основной фокус на функциональность, а не на производительность

### 3.2 Основной функционал MVP
1. **Импорт сделок из HTML-отчетов Сбербанка**
2. **Ручной ввод сделок**
3. **Управление позициями**
4. **Дневниковые заметки**
5. **Методика "Лесенка" для покупок/продаж**
6. **Базовая аналитика (доходность, P/L)**
7. **Получение котировок MOEX**
8. **Голосовой ввод заметок**
9. **Экспорт данных**

### 3.3 Архитектурные особенности MVP
- Упрощенная модель данных без поддержки множества пользователей
- Локальная база данных (PostgreSQL)
- Без сложных систем аутентификации
- Фокус на функциональность, а не на масштабируемость

## 4. Функциональные требования

### 4.1 Пользователь
- **Одна учетная запись** с жестко заданными параметрами
- Возможность обновления профиля (часовой пояс, настройки)
- Без системы регистрации/авторизации как таковой

### 4.2 Импорт сделок
- Поддержка импорта HTML-отчетов Сбербанка (суточные и месячные)
- Система разрешения конфликтов с существующими сделками
- "Черновик импорта" для безопасной загрузки данных
- Поддержка повторного импорта и обновления данных

### 4.3 Управление сделками
- Создание сделок вручную
- Редактирование/удаление сделок
- Привязка заметок к сделкам
- Поддержка всех типов операций (покупка/продажа)

### 4.4 Позиции
- Автоматическое объединение сделок по инструменту в позиции
- Расчет средней цены и P/L для позиций
- Поддержка методики "Лесенка"
- Целевые цены и уровни

### 4.5 Аналитика
- Расчет доходности по FIFO методу
- Учет комиссий в расчетах
- Базовая визуализация (доход/убыток по позициям)
- История изменений позиций

### 4.6 Заметки и дневник
- Поддержка текстовых заметок к позициям и сделкам
- Голосовой ввод через Web Speech API
- Категоризация заметок
- Возможность редактирования

### 4.7 Интеграции
- Получение котировок с MOEX
- Экспорт данных (JSON, CSV)
- Поддержка файлов отчетов брокера

## 5. Нефункциональные требования

### 5.1 Производительность
- Ответы API в пределах 2-3 секунд
- Загрузка страниц в пределах 3-5 секунд
- Поддержка до 10,000 сделок без значительного падения производительности

### 5.2 Безопасность
- Защита локальной базы данных
- Безопасное хранение чувствительных данных
- Защита от атак на уровне приложения (SQL-инъекции, XSS и т.д.)

### 5.3 Надежность
- Регулярное резервное копирование данных
- Обработка ошибок без краха системы
- Восстановление после сбоев

## 6. Технологический стек

### 6.1 Backend
- Python (FastAPI)
- SQLAlchemy + Alembic
- PostgreSQL
- BeautifulSoup/lxml для парсинга
- Pytest для тестов

### 6.2 Frontend
- React/Next.js
- Material UI
- Web Speech API
- Chart.js для визуализации

### 6.3 DevOps
- Docker для контейнеризации
- GitHub для CI/CD (в будущем)

## 7. Требования к однопользовательской версии

### 7.1 Архитектурные особенности
- Отсутствие многопользовательской архитектуры
- Упрощенная модель данных без поля user_id в основных сущностях
- Нет системы регистрации и аутентификации (один заранее определенный пользователь)
- Нет ролевой системы (только один пользователь с полными правами)
- Упрощенная система настроек (без мульти-пользовательских настроек)

### 7.2 Безопасность
- Простая аутентификация (например, сессия или токен для одного пользователя)
- Без OAuth интеграций
- Без защиты от DDoS и других атак, связанных с множественными пользователями
- Основное внимание на защиту от веб-уязвимостей (XSS, CSRF, SQL-инъекции)

### 7.3 Функциональные особенности
- Нет необходимости в изоляции данных между пользователями
- Нет необходимости в мульти-арендной архитектуре
- Нет требований к квотам и ограничениям по использованию
- Нет необходимости в системе биллинга или подписок

### 7.4 Тестирование и разработка
- Упрощенное тестирование (без учета многопользовательских сценариев)
- Фокус на функциональность, а не на масштабируемость
- Возможность локальной разработки и тестирования без сложной инфраструктуры

## 8. Минимально необходимый функционал для начала работы (MVP Core Features)

### 8.1 Ядро системы (обязательно для начала)
1. **Модель данных**:
   - Таблицы: trades, positions, notes
   - Основные поля для хранения сделок, позиций и заметок
   - Связи между сущностями

2. **Базовые CRUD-операции**:
   - Создание, чтение, обновление и удаление сделок
   - Создание и управление позициями
   - Добавление и редактирование заметок

3. **Простой веб-интерфейс**:
   - Страница списка позиций
   - Страница добавления сделки
   - Базовая навигация

### 8.2 Функции, необходимые для полезности
1. **Импорт сделок**:
   - Простейший парсер HTML-отчетов Сбербанка
   - Загрузка файла и отображение найденных сделок
   - Возможность подтверждения импорта

2. **Расчеты**:
   - Расчет средней цены позиции
   - Расчет P/L для каждой позиции
   - Простые формулы без учета FIFO и сложных комиссий

3. **Базовая аналитика**:
   - Отображение текущей доходности по позициям
   - Простой список сделок с основной информацией

## 9. План разработки по этапам

### Этап 1: Подготовка и основа (1-2 недели)
**Цель**: Создать базовую архитектуру и минимальную функциональность

1. **Настройка окружения**
   - Установка и настройка PostgreSQL
   - Настройка Python виртуального окружения
   - Настройка FastAPI приложения
   - Настройка системы управления версиями

2. **Создание базовой модели данных**
   - Таблицы: trades, positions, notes
   - Определение полей и связей
   - Создание миграций Alembic

3. **Реализация базовых API-эндпоинтов**
   - CRUD для сделок
   - CRUD для позиций
   - CRUD для заметок

4. **Создание простого веб-интерфейса**
   - Страница списка позиций
   - Форма добавления сделки

### Этап 2: Функциональность (2-3 недели)
**Цель**: Реализовать основные функции для работы с данными

1. **Реализация расчетов**
   - Расчет средней цены позиции
   - Расчет P/L для позиций
   - Отображение результатов в интерфейсе

2. **Базовый импорт**
   - Простой парсер HTML-отчетов Сбербанка
   - Загрузка файла и отображение данных
   - Подтверждение импорта

3. **Улучшение интерфейса**
   - Страница деталей позиции
   - Список сделок с фильтрами
   - Отображение аналитики

### Этап 3: Улучшения (2-3 недели)
**Цель**: Добавить дополнительные функции и улучшить UX

1. **Улучшенный импорт**
   - Обработка разных форматов отчетов
   - Проверки и валидация данных
   - Система отчетов об импорте

2. **Аналитика**
   - Построение графиков
   - Расширенные метрики
   - Экспорт в CSV

3. **UX улучшения**
   - Оптимизация производительности
   - Улучшенные формы ввода
   - Поддержка горячих клавиш

### Этап 4: Расширенная функциональность (2-3 недели)
**Цель**: Добавить передовые функции

1. **Методика "Лесенка"**
   - Уровни покупок/продаж
   - Планирование позиций
   - Визуализация уровней

2. **Котировки MOEX**
   - Интеграция с внешним API
   - Автоматическое обновление цен
   - Пересчет аналитики

3. **Голосовой ввод**
   - Интеграция Web Speech API
   - Обработка голосовых заметок
   - Улучшение UX для заметок

### Этап 5: Подготовка к масштабированию (1-2 недели)
**Цель**: Подготовить систему к возможному переходу в продакшен

1. **Многопользовательская архитектура**
   - Добавление поля user_id к сущностям
   - Адаптация всех запросов и интерфейсов
   - Система аутентификации

2. **Безопасность**
   - Внедрение JWT аутентификации
   - Защита эндпоинтов
   - Валидация входных данных

3. **Тестирование**
   - Unit-тесты
   - Интеграционные тесты
   - Покрытие 70%+ кода

## 10. Критерии для перехода к продакшену

### 10.1 Функциональные критерии
1. **Полнота функционала**:
   - Все основные функции MVP работают стабильно
   - Реализован импорт отчетов со всеми проверками
   - Корректно работают все расчеты (FIFO, комиссии, P/L)
   - Доступна аналитика и визуализации

2. **Качество кода**:
   - Покрытие unit-тестами не менее 70%
   - Код соответствует стандартам (PEP 8, etc.)
   - Пройдена проверка статическим анализатором
   - Нет критических и высокоприоритетных багов

### 10.2 Пользовательские критерии
1. **Период использования**:
   - Система используется автором проекта как основной инструмент ведения дневника в течение 1 месяца
   - Нет критических недостатков, мешающих работе
   - Пользователь доволен UX и функциональностью

2. **Объем данных**:
   - Система стабильно работает с 1000+ сделок
   - Производительность не падает ниже установленных порогов
   - Нет проблем с производительностью при работе с историческими данными

### 10.3 Технические критерии
1. **Безопасность**:
   - Реализована многопользовательская архитектура
   - Внедрена надежная аутентификация и авторизация
   - Пройдена проверка на уязвимости

2. **Масштабируемость**:
   - Система готова к работе с множеством пользователей
   - Реализованы механизмы кэширования
   - Настроено логирование и мониторинг

### 10.4 Бизнес критерии
1. **Оценка ценности**:
   - Система действительно улучшает процесс ведения дневника
   - Увеличивает эффективность анализа сделок
   - Пользователь готов платить за использование (в случае коммерческой версии)

2. **Обратная связь**:
   - Получена положительная обратная связь от других трейдеров (если тестировалось)
   - Есть запросы на использование системы другими людьми
   - Выявлены возможности для улучшения, но не критические проблемы

Если все критерии выполнены, проект может быть подготовлен для публичного запуска с дальнейшим расширением функционала и пользовательской базы.

## 11. Дополнительный функционал: Интеграция с Telegram

### 11.1 Описание функции
Приложение предоставляет возможность автоматической публикации информации о сделках в указанную Telegram-группу. После создания или редактирования сделки пользователь может выбрать опцию отправки деталей сделки в Telegram.

### 11.2 Функциональные требования
- **Опциональная отправка**: При создании/редактировании сделки - чекбокс "Опубликовать в Telegram"
- **Структурированное сообщение**: Включает тикер, тип операции, количество, цену, дату, комиссию, заметку
- **Конфигурация**: Возможность указать токен Telegram-бота и ID целевой группы
- **Обработка ошибок**: Уведомление пользователя при неудачной отправке

### 11.3 Технические требования
- **Telegram Bot API**: Использование официального API
- **Асинхронная отправка**: Отправка не должна блокировать основной поток
- **Безопасность**: Защита токена бота и проверка целостности данных

Если все критерии выполнены, проект может быть подготовлен для публичного запуска с дальнейшим расширением функционала и пользовательской базы.